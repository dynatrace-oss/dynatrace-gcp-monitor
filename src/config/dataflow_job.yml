id: dataflow_job
$schema: gcp_schema_v_1_0.json
version: 0.0.1
minDynatraceVersion: 1.199
vars:
- id: filter_conditions
  displayName: Metric query filter for which metrics should be queried
  type: variables
technology:
  name: Google Dataflow Job
gcp:
- service: dataflow_job
  gcpMonitoringFilter: var:filter_conditions
  dimensions:
  - value: label:resource.labels.project_id
    key: project_id
    compatibilityModeOnly: true
  - value: label:resource.labels.project_id
    key: gcp.project.id
  - value: label:resource.labels.job_name
    key: job_name
    compatibilityModeOnly: true
  - value: label:resource.labels.job_name
    key: gcp.instance.name
  - value: label:resource.labels.region
    key: region
    compatibilityModeOnly: true
  - value: label:resource.labels.region
    key: gcp.region
  metrics:
  - value: metric:dataflow.googleapis.com/job/billable_shuffle_data_processed
    key: cloud.gcp.dataflow_googleapis_com.job.billable_shuffle_data_processed
    type: gauge
    name: Billable shuffle data processed
    gcpOptions:
      ingestDelay: 180
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: By
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
  - value: metric:dataflow.googleapis.com/job/current_num_vcpus
    key: cloud.gcp.dataflow_googleapis_com.job.current_num_vcpus
    type: gauge
    name: Current number of vCPUs in use
    gcpOptions:
      ingestDelay: 180
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: '1'
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
  - value: metric:dataflow.googleapis.com/job/current_shuffle_slots
    key: cloud.gcp.dataflow_googleapis_com.job.current_shuffle_slots
    type: gauge
    name: Current shuffle slots in use
    gcpOptions:
      ingestDelay: 180
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: '1'
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
  - value: metric:dataflow.googleapis.com/job/data_watermark_age
    key: cloud.gcp.dataflow_googleapis_com.job.data_watermark_age
    type: gauge
    name: Data watermark lag
    gcpOptions:
      ingestDelay: 180
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: s
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
  - value: metric:dataflow.googleapis.com/job/elapsed_time
    key: cloud.gcp.dataflow_googleapis_com.job.elapsed_time
    type: gauge
    name: Elapsed time
    gcpOptions:
      ingestDelay: 180
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: s
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
  - value: metric:dataflow.googleapis.com/job/element_count
    key: cloud.gcp.dataflow_googleapis_com.job.element_count
    type: gauge
    name: Element count
    gcpOptions:
      ingestDelay: 180
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: '1'
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
    - value: label:metric.labels.pcollection
      key: pcollection
  - value: metric:dataflow.googleapis.com/job/elements_produced_count
    key: cloud.gcp.dataflow_googleapis_com.job.elements_produced_count
    type: count,delta
    name: Elements Produced
    gcpOptions:
      ingestDelay: 180
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: '1'
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
    - value: label:metric.labels.pcollection
      key: pcollection
    - value: label:metric.labels.ptransform
      key: ptransform
  - value: metric:dataflow.googleapis.com/job/estimated_byte_count
    key: cloud.gcp.dataflow_googleapis_com.job.estimated_byte_count
    type: gauge
    name: Estimated byte count
    gcpOptions:
      ingestDelay: 180
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: By
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
    - value: label:metric.labels.pcollection
      key: pcollection
  - value: metric:dataflow.googleapis.com/job/estimated_bytes_produced_count
    key: cloud.gcp.dataflow_googleapis_com.job.estimated_bytes_produced_count
    type: count,delta
    name: Estimated Bytes Produced
    gcpOptions:
      ingestDelay: 180
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: '1'
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
    - value: label:metric.labels.pcollection
      key: pcollection
    - value: label:metric.labels.ptransform
      key: ptransform
  - value: metric:dataflow.googleapis.com/job/is_failed
    key: cloud.gcp.dataflow_googleapis_com.job.is_failed
    type: gauge
    name: Failed
    gcpOptions:
      ingestDelay: 60
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: '1'
    dimensions: []
  - value: metric:dataflow.googleapis.com/job/per_stage_data_watermark_age
    key: cloud.gcp.dataflow_googleapis_com.job.per_stage_data_watermark_age
    type: gauge
    name: Per-stage data watermark lag
    gcpOptions:
      ingestDelay: 180
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: s
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
    - value: label:metric.labels.stage
      key: stage
  - value: metric:dataflow.googleapis.com/job/per_stage_system_lag
    key: cloud.gcp.dataflow_googleapis_com.job.per_stage_system_lag
    type: gauge
    name: Per-stage system lag
    gcpOptions:
      ingestDelay: 180
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: s
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
    - value: label:metric.labels.stage
      key: stage
  - value: metric:dataflow.googleapis.com/job/pubsub/read_count
    key: cloud.gcp.dataflow_googleapis_com.job.pubsub.read_count
    type: count,delta
    name: PubsubIO.Read requests from Dataflow jobs
    gcpOptions:
      ingestDelay: 60
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: '1'
    dimensions:
    - value: label:metric.labels.status
      key: status
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
    - value: label:metric.labels.ptransform
      key: ptransform
    - value: label:metric.labels.subscription_project_id
      key: subscription_project_id
    - value: label:metric.labels.subscription_id
      key: subscription_id
    - value: label:metric.labels.topic_project_id
      key: topic_project_id
    - value: label:metric.labels.topic_id
      key: topic_id
  - value: metric:dataflow.googleapis.com/job/pubsub/read_latencies
    key: cloud.gcp.dataflow_googleapis_com.job.pubsub.read_latencies
    type: gauge
    name: Pub/Sub Pull Request Latencies
    gcpOptions:
      ingestDelay: 60
      samplePeriod: 60
      valueType: DISTRIBUTION
      metricKind: DELTA
      unit: ms
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
    - value: label:metric.labels.ptransform
      key: ptransform
    - value: label:metric.labels.subscription_project_id
      key: subscription_project_id
    - value: label:metric.labels.subscription_id
      key: subscription_id
    - value: label:metric.labels.topic_project_id
      key: topic_project_id
    - value: label:metric.labels.topic_id
      key: topic_id
  - value: metric:dataflow.googleapis.com/job/pubsub/write_count
    key: cloud.gcp.dataflow_googleapis_com.job.pubsub.write_count
    type: count,delta
    name: Pub/Sub Publish Requests
    gcpOptions:
      ingestDelay: 60
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: '1'
    dimensions:
    - value: label:metric.labels.status
      key: status
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
    - value: label:metric.labels.ptransform
      key: ptransform
    - value: label:metric.labels.topic_project_id
      key: topic_project_id
    - value: label:metric.labels.topic_id
      key: topic_id
  - value: metric:dataflow.googleapis.com/job/pubsub/write_latencies
    key: cloud.gcp.dataflow_googleapis_com.job.pubsub.write_latencies
    type: gauge
    name: Pub/Sub Publish Request Latencies
    gcpOptions:
      ingestDelay: 60
      samplePeriod: 60
      valueType: DISTRIBUTION
      metricKind: DELTA
      unit: ms
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
    - value: label:metric.labels.ptransform
      key: ptransform
    - value: label:metric.labels.topic_project_id
      key: topic_project_id
    - value: label:metric.labels.topic_id
      key: topic_id
  - value: metric:dataflow.googleapis.com/job/status
    key: cloud.gcp.dataflow_googleapis_com.job.status
    type: gauge
    name: Status
    gcpOptions:
      ingestDelay: 60
      samplePeriod: 60
      valueType: STRING
      metricKind: GAUGE
      unit: ''
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
  - value: metric:dataflow.googleapis.com/job/system_lag
    key: cloud.gcp.dataflow_googleapis_com.job.system_lag
    type: gauge
    name: System lag
    gcpOptions:
      ingestDelay: 180
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: s
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
  - value: metric:dataflow.googleapis.com/job/total_memory_usage_time
    key: cloud.gcp.dataflow_googleapis_com.job.total_memory_usage_time
    type: gauge
    name: Total memory usage time
    gcpOptions:
      ingestDelay: 180
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: GBy.s
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
  - value: metric:dataflow.googleapis.com/job/total_pd_usage_time
    key: cloud.gcp.dataflow_googleapis_com.job.total_pd_usage_time
    type: gauge
    name: Total PD usage time
    gcpOptions:
      ingestDelay: 180
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: GBy.s
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
    - value: label:metric.labels.storage_type
      key: storage_type
  - value: metric:dataflow.googleapis.com/job/total_shuffle_data_processed
    key: cloud.gcp.dataflow_googleapis_com.job.total_shuffle_data_processed
    type: gauge
    name: Total shuffle data processed
    gcpOptions:
      ingestDelay: 180
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: By
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
  - value: metric:dataflow.googleapis.com/job/total_streaming_data_processed
    key: cloud.gcp.dataflow_googleapis_com.job.total_streaming_data_processed
    type: gauge
    name: Total streaming data processed
    gcpOptions:
      ingestDelay: 180
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: By
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
  - value: metric:dataflow.googleapis.com/job/total_vcpu_time
    key: cloud.gcp.dataflow_googleapis_com.job.total_vcpu_time
    type: gauge
    name: Total vCPU time
    gcpOptions:
      ingestDelay: 180
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: s
    dimensions:
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
  - value: metric:dataflow.googleapis.com/job/user_counter
    key: cloud.gcp.dataflow_googleapis_com.job.user_counter
    type: gauge
    name: User Counter
    gcpOptions:
      ingestDelay: 180
      samplePeriod: 60
      valueType: DOUBLE
      metricKind: GAUGE
      unit: '1'
    dimensions:
    - value: label:metric.labels.metric_name
      key: metric_name
    - value: label:metric.labels.job_id
      key: job_id
      compatibilityModeOnly: true
    - value: label:metric.labels.job_id
      key: job_id
    - value: label:metric.labels.ptransform
      key: ptransform
