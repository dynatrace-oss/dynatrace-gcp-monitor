id: spanner_instance
$schema: gcp_schema_v_1_0.json
version: 0.0.1
minDynatraceVersion: 1.199
vars:
 - id: filter_conditions
   displayName: Metric query filter for which metrics should be queried
   type: variables
technology:
  name: Google Cloud Spanner Instance
gcp:
- service: spanner_instance
  featureSet: default
  gcpMonitoringFilter: var:filter_conditions
  dimensions:
  - value: resource.labels.project_id
    key: project_id
    compatibilityModeOnly: true
  - value: resource.labels.project_id
    key: gcp.project.id
  - value: resource.labels.instance_id
    key: instance_id
    compatibilityModeOnly: true
  - value: resource.labels.instance_id
    key: gcp.instance.id
  - value: resource.labels.location
    key: location
    compatibilityModeOnly: true
  - value: resource.labels.location
    key: gcp.region
  - value: resource.labels.instance_config
    key: instance_config
  metrics:
  - value: spanner.googleapis.com/api/api_request_count
    key: cloud.gcp.spanner_googleapis_com.api.api_request_count
    type: count,delta
    name: API requests
    gcpOptions:
      ingestDelay: 120
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: '1'
    dimensions:
    - value: metric.labels.database
    - value: metric.labels.status
    - value: metric.labels.method
  - value: spanner.googleapis.com/api/received_bytes_count
    key: cloud.gcp.spanner_googleapis_com.api.received_bytes_count
    type: count,delta
    name: Bytes received by Cloud Spanner.
    gcpOptions:
      ingestDelay: 120
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: By
    dimensions:
    - value: metric.labels.database
    - value: metric.labels.method
  - value: spanner.googleapis.com/api/request_count
    key: cloud.gcp.spanner_googleapis_com.api.request_count
    type: gauge
    name: API request rate
    gcpOptions:
      ingestDelay: 120
      samplePeriod: 60
      valueType: DOUBLE
      metricKind: GAUGE
      unit: 1/s
    dimensions:
    - value: metric.labels.database
    - value: metric.labels.status
    - value: metric.labels.method
  - value: spanner.googleapis.com/api/request_latencies
    key: cloud.gcp.spanner_googleapis_com.api.request_latencies
    type: gauge
    name: Request latencies
    gcpOptions:
      ingestDelay: 120
      samplePeriod: 60
      valueType: DISTRIBUTION
      metricKind: DELTA
      unit: s
    dimensions:
    - value: metric.labels.database
    - value: metric.labels.method
  - value: spanner.googleapis.com/api/sent_bytes_count
    key: cloud.gcp.spanner_googleapis_com.api.sent_bytes_count
    type: count,delta
    name: Bytes sent by Cloud Spanner.
    gcpOptions:
      ingestDelay: 120
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: By
    dimensions:
    - value: metric.labels.database
    - value: metric.labels.method
  - value: spanner.googleapis.com/instance/backup/used_bytes
    key: cloud.gcp.spanner_googleapis_com.instance.backup.used_bytes
    type: gauge
    name: Backup storage used.
    gcpOptions:
      ingestDelay: 120
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: By
    dimensions:
    - value: metric.labels.database
    - value: metric.labels.backup
  - value: spanner.googleapis.com/instance/cpu/smoothed_utilization
    key: cloud.gcp.spanner_googleapis_com.instance.cpu.smoothed_utilization
    type: gauge
    name: Smoothed CPU utilization
    gcpOptions:
      ingestDelay: 120
      samplePeriod: 60
      valueType: DOUBLE
      metricKind: GAUGE
      unit: 10^2.%
    dimensions:
    - value: metric.labels.database
  - value: spanner.googleapis.com/instance/cpu/utilization
    key: cloud.gcp.spanner_googleapis_com.instance.cpu.utilization
    type: gauge
    name: CPU utilization
    gcpOptions:
      ingestDelay: 120
      samplePeriod: 60
      valueType: DOUBLE
      metricKind: GAUGE
      unit: 10^2.%
    dimensions:
    - value: metric.labels.database
  - value: spanner.googleapis.com/instance/cpu/utilization_by_priority
    key: cloud.gcp.spanner_googleapis_com.instance.cpu.utilization_by_priority
    type: gauge
    name: CPU utilization by priority
    gcpOptions:
      ingestDelay: 120
      samplePeriod: 60
      valueType: DOUBLE
      metricKind: GAUGE
      unit: 10^2.%
    dimensions:
    - value: metric.labels.database
    - value: metric.labels.is_system
    - value: metric.labels.priority
  - value: spanner.googleapis.com/instance/node_count
    key: cloud.gcp.spanner_googleapis_com.instance.node_count
    type: gauge
    name: Nodes
    gcpOptions:
      ingestDelay: 120
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: '1'
    dimensions: []
  - value: spanner.googleapis.com/instance/session_count
    key: cloud.gcp.spanner_googleapis_com.instance.session_count
    type: gauge
    name: Sessions
    gcpOptions:
      ingestDelay: 120
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: '1'
    dimensions:
    - value: metric.labels.database
  - value: spanner.googleapis.com/instance/storage/limit_bytes
    key: cloud.gcp.spanner_googleapis_com.instance.storage.limit_bytes
    type: gauge
    name: Storage limit
    gcpOptions:
      ingestDelay: 120
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: By
    dimensions:
    - value: metric.labels.storage_class
  - value: spanner.googleapis.com/instance/storage/used_bytes
    key: cloud.gcp.spanner_googleapis_com.instance.storage.used_bytes
    type: gauge
    name: Storage used.
    gcpOptions:
      ingestDelay: 120
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: By
    dimensions:
    - value: metric.labels.database
    - value: metric.labels.storage_class
  - value: spanner.googleapis.com/instance/storage/utilization
    key: cloud.gcp.spanner_googleapis_com.instance.storage.utilization
    type: gauge
    name: Storage utilization
    gcpOptions:
      ingestDelay: 120
      samplePeriod: 60
      valueType: DOUBLE
      metricKind: GAUGE
      unit: 10^2.%
    dimensions:
    - value: metric.labels.storage_class
  - value: spanner.googleapis.com/query_count
    key: cloud.gcp.spanner_googleapis_com.query_count
    type: count,delta
    name: Count of queries
    gcpOptions:
      ingestDelay: 120
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: '1'
    dimensions:
    - value: metric.labels.database
    - value: metric.labels.status
    - value: metric.labels.query_type
    - value: metric.labels.optimizer_version
alerts:
  - path: "alerts/spanner_instance/cpu.utilization.json"
  - path: "alerts/spanner_instance/storage.utilization.json"