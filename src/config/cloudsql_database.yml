id: cloudsql_database
$schema: gcp_schema_v_1_0.json
version: 0.0.1
minDynatraceVersion: 1.199
vars:
- id: filter_conditions
  displayName: Metric query filter for which metrics should be queried
  type: variables
technology:
  name: Cloud SQL Database
gcp:
- service: cloudsql_database
  gcpMonitoringFilter: var:filter_conditions
  dimensions:
  - value: label:resource.labels.project_id
    key: project_id
    compatibilityModeOnly: true
  - value: label:resource.labels.project_id
    key: gcp.project.id
  - value: label:resource.labels.database_id
    key: database_id
    compatibilityModeOnly: true
  - value: label:resource.labels.database_id
    key: gcp.instance.id
  - value: label:resource.labels.region
    key: region
    compatibilityModeOnly: true
  - value: label:resource.labels.region
    key: gcp.region
  metrics:
  - value: metric:cloudsql.googleapis.com/database/auto_failover_request_count
    key: cloud.gcp.cloudsql_googleapis_com.database.auto_failover_request_count
    type: count,delta
    name: Auto-failover Requests
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/available_for_failover
    key: cloud.gcp.cloudsql_googleapis_com.database.available_for_failover
    type: gauge
    name: Available for failover
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/cpu/reserved_cores
    key: cloud.gcp.cloudsql_googleapis_com.database.cpu.reserved_cores
    type: gauge
    name: CPU reserved cores
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: DOUBLE
      metricKind: GAUGE
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/cpu/usage_time
    key: cloud.gcp.cloudsql_googleapis_com.database.cpu.usage_time
    type: count,delta
    name: CPU usage
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: DOUBLE
      metricKind: DELTA
      unit: s{CPU}
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/cpu/utilization
    key: cloud.gcp.cloudsql_googleapis_com.database.cpu.utilization
    type: gauge
    name: CPU utilization
    gcpOptions:
      ingestDelay: 150
      samplePeriod: 60
      valueType: DOUBLE
      metricKind: GAUGE
      unit: 10^2.%
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/disk/bytes_used
    key: cloud.gcp.cloudsql_googleapis_com.database.disk.bytes_used
    type: gauge
    name: Bytes used
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: By
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/disk/quota
    key: cloud.gcp.cloudsql_googleapis_com.database.disk.quota
    type: gauge
    name: Disk quota
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: By
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/disk/read_ops_count
    key: cloud.gcp.cloudsql_googleapis_com.database.disk.read_ops_count
    type: count,delta
    name: Disk read IO
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/disk/utilization
    key: cloud.gcp.cloudsql_googleapis_com.database.disk.utilization
    type: gauge
    name: Disk utilization
    gcpOptions:
      ingestDelay: 150
      samplePeriod: 60
      valueType: DOUBLE
      metricKind: GAUGE
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/disk/write_ops_count
    key: cloud.gcp.cloudsql_googleapis_com.database.disk.write_ops_count
    type: count,delta
    name: Disk write IO
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/instance_state
    key: cloud.gcp.cloudsql_googleapis_com.database.instance_state
    type: gauge
    name: Instance state
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: BOOL
      metricKind: GAUGE
      unit: ''
    dimensions:
    - value: label:metric.labels.state
      key: state
  - value: metric:cloudsql.googleapis.com/database/memory/quota
    key: cloud.gcp.cloudsql_googleapis_com.database.memory.quota
    type: gauge
    name: Memory quota
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: By
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/memory/usage
    key: cloud.gcp.cloudsql_googleapis_com.database.memory.usage
    type: gauge
    name: Memory usage
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: By
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/memory/utilization
    key: cloud.gcp.cloudsql_googleapis_com.database.memory.utilization
    type: gauge
    name: Memory utilization
    gcpOptions:
      ingestDelay: 150
      samplePeriod: 60
      valueType: DOUBLE
      metricKind: GAUGE
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/mysql/innodb_buffer_pool_pages_dirty
    key: cloud.gcp.cloudsql_googleapis_com.database.mysql.innodb_buffer_pool_pages_dirty
    type: gauge
    name: InnoDB dirty pages
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/mysql/innodb_buffer_pool_pages_free
    key: cloud.gcp.cloudsql_googleapis_com.database.mysql.innodb_buffer_pool_pages_free
    type: gauge
    name: InnoDB free pages
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/mysql/innodb_buffer_pool_pages_total
    key: cloud.gcp.cloudsql_googleapis_com.database.mysql.innodb_buffer_pool_pages_total
    type: gauge
    name: InnoDB total pages
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/mysql/innodb_data_fsyncs
    key: cloud.gcp.cloudsql_googleapis_com.database.mysql.innodb_data_fsyncs
    type: count,delta
    name: InnoDB fsync calls
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/mysql/innodb_os_log_fsyncs
    key: cloud.gcp.cloudsql_googleapis_com.database.mysql.innodb_os_log_fsyncs
    type: count,delta
    name: InnoDB log fsync calls
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/mysql/innodb_pages_read
    key: cloud.gcp.cloudsql_googleapis_com.database.mysql.innodb_pages_read
    type: count,delta
    name: InnoDB pages read
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/mysql/innodb_pages_written
    key: cloud.gcp.cloudsql_googleapis_com.database.mysql.innodb_pages_written
    type: count,delta
    name: InnoDB pages written
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/mysql/queries
    key: cloud.gcp.cloudsql_googleapis_com.database.mysql.queries
    type: count,delta
    name: Queries
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/mysql/questions
    key: cloud.gcp.cloudsql_googleapis_com.database.mysql.questions
    type: count,delta
    name: Questions
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/mysql/received_bytes_count
    key: cloud.gcp.cloudsql_googleapis_com.database.mysql.received_bytes_count
    type: count,delta
    name: Network bytes received by MySQL
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: By
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/mysql/replication/available_for_failover
    key: cloud.gcp.cloudsql_googleapis_com.database.mysql.replication.available_for_failover
    type: gauge
    name: Available for failover (Deprecated)
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/mysql/replication/last_io_errno
    key: cloud.gcp.cloudsql_googleapis_com.database.mysql.replication.last_io_errno
    type: gauge
    name: Last I/O thread error number.
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/mysql/replication/last_sql_errno
    key: cloud.gcp.cloudsql_googleapis_com.database.mysql.replication.last_sql_errno
    type: gauge
    name: Last SQL thread error number.
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/mysql/replication/seconds_behind_master
    key: cloud.gcp.cloudsql_googleapis_com.database.mysql.replication.seconds_behind_master
    type: gauge
    name: Replica lag
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: s
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/mysql/replication/slave_io_running
    key: cloud.gcp.cloudsql_googleapis_com.database.mysql.replication.slave_io_running
    type: gauge
    name: Slave I/O thread running
    gcpOptions:
      ingestDelay: 60
      samplePeriod: 60
      valueType: STRING
      metricKind: GAUGE
      unit: ''
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/mysql/replication/slave_io_running_state
    key: cloud.gcp.cloudsql_googleapis_com.database.mysql.replication.slave_io_running_state
    type: gauge
    name: Slave I/O thread running state
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: BOOL
      metricKind: GAUGE
      unit: ''
    dimensions:
    - value: label:metric.labels.state
      key: state
  - value: metric:cloudsql.googleapis.com/database/mysql/replication/slave_sql_running
    key: cloud.gcp.cloudsql_googleapis_com.database.mysql.replication.slave_sql_running
    type: gauge
    name: Slave SQL thread running
    gcpOptions:
      ingestDelay: 60
      samplePeriod: 60
      valueType: STRING
      metricKind: GAUGE
      unit: ''
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/mysql/replication/slave_sql_running_state
    key: cloud.gcp.cloudsql_googleapis_com.database.mysql.replication.slave_sql_running_state
    type: gauge
    name: Slave SQL thread running state
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: BOOL
      metricKind: GAUGE
      unit: ''
    dimensions:
    - value: label:metric.labels.state
      key: state
  - value: metric:cloudsql.googleapis.com/database/mysql/sent_bytes_count
    key: cloud.gcp.cloudsql_googleapis_com.database.mysql.sent_bytes_count
    type: count,delta
    name: Network bytes sent by MySQL
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: By
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/network/connections
    key: cloud.gcp.cloudsql_googleapis_com.database.network.connections
    type: gauge
    name: Cloud SQL Connections
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/network/received_bytes_count
    key: cloud.gcp.cloudsql_googleapis_com.database.network.received_bytes_count
    type: count,delta
    name: Received bytes
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: By
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/network/sent_bytes_count
    key: cloud.gcp.cloudsql_googleapis_com.database.network.sent_bytes_count
    type: count,delta
    name: Sent bytes
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: By
    dimensions:
    - value: label:metric.labels.destination
      key: destination
  - value: metric:cloudsql.googleapis.com/database/postgresql/num_backends
    key: cloud.gcp.cloudsql_googleapis_com.database.postgresql.num_backends
    type: gauge
    name: PostgreSQL Connections
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: '1'
    dimensions:
    - value: label:metric.labels.database
      key: database
  - value: metric:cloudsql.googleapis.com/database/postgresql/replication/replica_byte_lag
    key: cloud.gcp.cloudsql_googleapis_com.database.postgresql.replication.replica_byte_lag
    type: gauge
    name: Lag bytes
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: By
    dimensions:
    - value: label:metric.labels.replica_name
      key: replica_name
    - value: label:metric.labels.replica_lag_type
      key: replica_lag_type
  - value: metric:cloudsql.googleapis.com/database/postgresql/transaction_count
    key: cloud.gcp.cloudsql_googleapis_com.database.postgresql.transaction_count
    type: count,delta
    name: Number of transactions
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: '1'
    dimensions:
    - value: label:metric.labels.database
      key: database
    - value: label:metric.labels.transaction_type
      key: transaction_type
  - value: metric:cloudsql.googleapis.com/database/replication/replica_lag
    key: cloud.gcp.cloudsql_googleapis_com.database.replication.replica_lag
    type: gauge
    name: Replica lag
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: DOUBLE
      metricKind: GAUGE
      unit: s
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/state
    key: cloud.gcp.cloudsql_googleapis_com.database.state
    type: gauge
    name: State
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: STRING
      metricKind: GAUGE
      unit: ''
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/up
    key: cloud.gcp.cloudsql_googleapis_com.database.up
    type: gauge
    name: Server up
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: GAUGE
      unit: '1'
    dimensions: []
  - value: metric:cloudsql.googleapis.com/database/uptime
    key: cloud.gcp.cloudsql_googleapis_com.database.uptime
    type: count,delta
    name: Uptime
    gcpOptions:
      ingestDelay: 210
      samplePeriod: 60
      valueType: INT64
      metricKind: DELTA
      unit: s
    dimensions: []
dashboards:
- dashboard: dashboards/cloudsql_database.json
alerts:
- path: alerts/cloudsql_database/cpu.utilization.json
